
# Use an Alpine Linux base image
Bootstrap: docker
From: alpine:latest

%environment
    export PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/opt/ImageSmith

%post
    
    # Update and install required packages
    apk update && apk add --no-cache \
        bash \
        build-base \
        go \
        git \
        linux-headers \
        libseccomp-dev \
        squashfs-tools \
        curl \
        openblas-dev \
        gfortran \
        python3 \
        py3-pip \
        python3-dev \
        py3-setuptools \
        py3-wheel \
        libxml2-dev \
        libcurl \
        curl-dev \
        linux-headers \
        zeromq-dev \
        gcc \
        g++ \
        gfortran \
        libffi-dev \
        openssl-dev \
        make \
        cmake \
	shadow \
        shadow-uidmap \
	fakeroot \
	apptainer
   

    # Install JupyterLab and its dependencies using pip
    export PIP_BREAK_SYSTEM_PACKAGES=1
    pip3 install --upgrade pip
    pip3 install jupyterlab

    git clone https://github.com/stela2502/Tutorial_Singularity.git
    mkdir /opt/ImageSmith
    cp -R Tutorial_Singularity/* /opt/ImageSmith

    cat <<EOF > /usr/local/bin/sudo
#!/bin/bash

# Check if the script is running as root
echo "sudo not necessary in image..."
"\$@"
EOF
   chmod +x /usr/local/bin/sudo
#   chown root:root /usr/bin/newuidmap

%runscript
  jupyter lab --port 9734 --ip=0.0.0.0 --allow-root --no-browser
